@using BlazorProject.Data

<MudDialog>
    <TitleContent>
        <MudText
            Typo="Typo.h5"
            Align="Align.Center"
        >
            Create Asset
        </MudText>
    </TitleContent>

    <DialogContent>
        <MudForm
            @ref="_form"
        >
            <MudTextField
                @bind-Value="NewAsset.Name"
                Label="Enter name"
                Required
                Immediate
            />
            
            <MudTextField
                @bind-Value="NewAsset.ISIN"
                Label="Enter ISIN"
            />
            
            <MudSelect
                Placeholder="Select type*"
                T="AssetType"
                @bind-Value="NewAsset.Type"
                Validation="@((AssetType value) => (int)value == 0 ? "Please specify the asset type" : null)"
            >
                @foreach (var type in Enum.GetValues<AssetType>()) {
                    <MudSelectItem
                        T="AssetType"
                        Value="@type"
                    />
                }
            </MudSelect>
        </MudForm>
    </DialogContent>

    <DialogActions>
        <MudButton OnClick="@(() => MudDialog.Cancel())">Cancel</MudButton>
        <MudButton
            ButtonType="ButtonType.Submit"
            Color="Color.Primary"
            OnClick="@( () => {
                         _form.Validate();

                         if (_form.IsValid) {
                             MudDialog.Close(DialogResult.Ok(new ReturnType(NewAsset)));
                         }
                     })"
        >
            Submit
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = null!;
    
    public Asset NewAsset { get; set; } = new();

    public record ReturnType(Asset Asset);

    private MudForm _form = null!;
}